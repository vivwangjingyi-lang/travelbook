# TravelBook 后端架构建议 (Draft)

## 背景分析
目前 TravelBook 采用 **Local-First (本地优先)** 架构，数据存储在浏览器的 `IndexedDB` 中。这种方式虽然具有高隐私性且零成本，但在存储上限和协作能力上存在天然局限。

## 后端的必要性评估

### 1. 存储空间 (Storage space)
-   **现状**：`IndexedDB` 的容量受限于浏览器配额（通常为磁盘剩余空间的百分比）。如果用户上传大量高分辨率照片作为封面或 POI 记录，可能会触发清理机制或达到上限。
-   **后端提升**：
    -   **云存储**：通过 S3（或 Supabase Storage / Firebase Storage）存储大文件，本地仅存储 URL。
    -   **持久化保证**：数据不再随浏览器缓存清理而丢失。

### 2. 鉴权与账户系统 (Authentication)
-   **现状**：没有用户概念，数据属于浏览器。无法识别用户身份。
-   **后端提升**：
    -   **登录功能**：支持邮箱/密码或第三方社交登录（如 GitHub, Google）。
    -   **数据隔离与安全**：每个用户只能访问自己的旅行书，数据存放在云端数据库中，安全性更高。
    -   **多端同步**：用户只需在不同设备登录账号，即可随时随地访问最新的旅行计划。

### 3. 多人协作 (Collaboration)
-   **现状**：本地存储是孤岛，无法实现多设备同步，更无法与其他用户共同编辑一份旅行计划。
-   **后端提升**：
    -   **实时同步**：引入 WebSocket 或实时数据库（如 Supabase Realtime）实现多人编辑。
    -   **冲突解决**：可以采用 CRDTs 或简单的最后写入者胜 (Last-Write-Wins) 策略处理并发修改。

## 方案对比

| 方案 | 优点 | 缺点 | 推荐指数 |
| :--- | :--- | :--- | :--- |
| **Supabase (推荐)** | 与 Next.js 完美集成，支持 PostgreSQL + Auth + Realtime + Storage。开发者体验极佳。 | 学习曲线略高于 Firebase。 | ⭐⭐⭐⭐⭐ |
| **Firebase** | 成熟稳定，文档丰富，实时数据库非常强大。 | Google 生态锁定，NoSQL 对复杂关系查询不友好。 | ⭐⭐⭐⭐ |
| **Convex** | 纯函数式后端，实时同步是其核心，极其简单。 | 社区规模相对较小。 | ⭐⭐⭐ |
| **自建 Node.js + DB** | 完全控制，无供应商锁定。 | 运维成本高，需要从零实现鉴权和同步逻辑。 | ⭐⭐ |

## 后续建议

> [!IMPORTANT]
> 是否引入后端取决于产品的目标定位。
> 1. 如果定位是 **“个人私密旅行日记”**，当前的本地存储已足够，后端仅作为可选的备份手段。
> 2. 如果定位是 **“团队旅行协作平台”**，后端是**必须项**。

## 询问用户
1. 您更倾向于哪种协作场景？（例如：多个好友同时编辑，还是仅仅是为了同步多端数据？）
2. 是否有现成的云服务账号（如 Supabase / Firebase）？
3. 是否需要考虑离线编辑功能？
