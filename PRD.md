# TravelBook 产品需求文档 (PRD)

| 项目名称 | TravelBook (旅行书) | 文档状态 | V2.0 (已定稿) |
| :--- | :--- | :--- | :--- |
| **文档作者** | Antigravity | **最后更新** | 2026-01-14 |
| **适用平台** | Web (Mobile/Desktop Responsive) | **密级** | 内部公开 |

## 1. 文档变更记录 (Version History)
| 版本 | 日期 | 修改人 | 修改内容 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| V1.0 | 2026-01-01 | Team | 初始版本 | 基础功能定义 |
| V2.0 | 2026-01-13 | Antigravity | 架构重构 | 增加世界视图、场景管理、规范化非功能需求 |
| V2.1 | 2026-01-14 | Antigravity | 功能增强 | 1. Canvas页面支持父子POI关系；2. Plot页面支持多场景切换 |

---

## 2. 产品概述 (Executive Summary)

### 2.1 项目背景
当前的旅行规划工具往往碎片化严重，用户需要在地图、笔记、预订软件之间反复切换。TravelBook 旨在提供一个**沉浸式、线性叙事与非线性探索相结合**的规划体验，将旅行规划过程转化为创作一本“书”的过程。

### 2.2 核心价值主张 (Value Proposition)
- **结构化叙事**：通过“章节”概念引导用户完成从灵感到结案的完整规划流。
- **可视化编排**：提供基于画布 (Canvas) 的自由拖拽与场景 (Scene) 管理，还原规划的探索乐趣。
- **本地优先 (Local-First)**：数据完全存储于本地，保护隐私且无需依赖网络服务即可查看。

### 2.3 成功指标 (Success Metrics)
*   **北极星指标**：用户完成一本“旅行书”并在 Epilogue 页面生成总结的比率。
*   **关键指标**：
    *   平均单次会话时长 (Session Duration)。
    *   Canvas 页面上的 POI 交互次数（拖拽、连线）。
    *   多场景 (Multi-Scene) 功能的使用率。

---

## 3. 用户画像 (User Personas)

### 3.1 P1: 指挥官型旅行者 (The Master Planner)
*   **特征**：喜欢掌控一切细节，追求行程的高效衔接。
*   **痛点**：现有工具难以直观展示多天行程的空间关系；难以处理复杂的城市间交通。
*   **需求**：需要精确的时刻表 (Plot 页面)、清晰的路线图以及待办事项清单。

### 3.2 P2: 体验派探索者 (The Experience Seeker)
*   **特征**：关注旅行的氛围感，规划较为随性，重视收集灵感。
*   **痛点**：传统的表格/列表式规划工具太枯燥，缺乏视觉刺激。
*   **需求**：高颜值的界面 (UI)、拖拽式的自由画布 (Canvas)、图文并茂的 POI 卡片。

---

## 4. 功能需求说明 (Functional Requirements)

需求优先级定义：
*   **P0 (Must-have)**: 核心功能，缺失导致产品不可用。
*   **P1 (Should-have)**: 重要功能，缺失影响体验完整性。
*   **P2 (Nice-to-have)**: 锦上添花的功能。

### 4.1 核心流程：章节导航系统 (Chapter Navigation)
*   **优先级**: P0
*   **描述**: 用户通过浮动胶囊导航栏在不同规划阶段间切换。
*   **功能点**:
    *   支持 0-5 六个章节的线性或非线性跳转。
    *   **未保存拦截**：当检测到 `isDirty` 状态时，必须弹窗阻断跳转，提示保存或丢弃。

### 4.2 章节解析

#### Chapter 0: Introduction (序章)
*   **优先级**: P0
*   **功能**:
    *   **元数据录入**：书名、目的地、日期范围（必填）；同伴、简介（选填）。
    *   **封面定制**：支持上传本地图片并进行自动压缩处理。

#### Chapter 1: Departure (出发)
*   **优先级**: P1
*   **功能**:
    *   **大交通管理**：管理出发地与目的地之间的往返交通（机票/火车）。
    *   **票务信息**：记录航班号、时间、座位等级。

#### Chapter 2: Collection (收集) - 灵感库
*   **优先级**: P0
*   **功能**:
    *   **POI 录入**：创建兴趣点，支持 6 种预设分类（住宿、景点、美食等）。
    *   **多维筛选**：支持按分类筛选、按名称搜索。
    *   **父子关系**：(P1) 支持定义地点的层级关系（如：迪士尼乐园 -> 明日世界）。

#### Chapter 3: Canvas (画布) - 核心可视化
*   **优先级**: P0
*   **功能**:
    *   **双视图模式**:
        *   **World View (世界视图)**：管理多个城市/场景 (Scene)，支持新建场景、场景间连线（交通）。
        *   **Scene View (场景视图)**：单一场景内的 POI 布局。
    *   **交互操作**:
        *   从侧边栏拖拽 POI 到画布。
        *   画布内自由拖拽布局。
        *   双击场景进入详情。
        *   **父子关系支持**：支持定义地点的层级关系（如：迪士尼乐园 -> 明日世界），自动建立父子连线，不限制添加顺序（可先添加子节点后添加父节点）。
    *   **视觉反馈**：连线自动吸附、父子节点连线、选中高亮。

#### Chapter 4: Plot (情节) - 行程编排
*   **优先级**: P1
*   **功能**:
    *   **每日行程表**：基于日期范围生成的每日容器。
    *   **排序逻辑**：将 Canvas 中的 POI 分配至具体日期并排序。
    *   **交通衔接**：自动计算或手动添加点对点之间的交通方式（步行、打车等）。
    *   **场景切换功能**：在 Select Points of Interest 界面中支持场景 (Scene) 切换，用户可以从不同场景选择 POI 添加到行程中，已选择的 POI 会累积显示。

#### Chapter 5: Epilogue (终章) - 总结与分享
*   **优先级**: P2
*   **功能**:
    *   **数据可视化**：行程统计（覆盖景点数、总里程估算）。
    *   **备忘录 (Memo)**：固定 (Pin) 重要信息。
    *   **导出/分享**：生成只读链接或导出 PDF（浏览器打印适配）。

---

## 5. 非功能需求 (Non-Functional Requirements)

### 5.1 数据隐私与存储 (Data & Privacy)
*   **Local-First 架构**: 所有数据默认存储于客户端 IndexedDB。
*   **存储限制**: 图片需经过 Canvas 压缩，确保单张图片 < 1MB，总数据库体积控制在浏览器配额内。
*   **兜底机制**: 若环境不支持 IndexedDB（如隐身模式），自动降级至 LocalStorage 并提示容量风险。

### 5.2 性能要求 (Performance)
*   **FCP (First Contentful Paint)**: < 1.5s。
*   **交互响应**: Canvas 拖拽帧率需稳定在 50fps 以上。
*   **内存管理**: 针对长列表 (Collection List) 和复杂 DOM (Canvas SVG) 进行虚拟化或节流处理。

### 5.3 国际化 (Localization)
*   **语言支持**: 英语 (en-US) 为默认，支持简体中文 (zh-CN)。
*   **扩展性**: 所有的 UI 文本必须通过 `i18n` 字典键值获取，不得硬编码。

### 5.4 兼容性 (Compatibility)
*   **浏览器**: Chrome 90+, Safari 15+, Firefox 90+, Edge。
*   **响应式**: 适配 Mobile (375px+), Tablet, Desktop (1920px)。

---

## 6. UI/UX 设计规范 (Design Guidelines)

### 6.1 设计语言：Ethereal Minimalism
*   **核心关键词**: 通透、流动、呼吸感。
*   **视觉特征**:
    *   **Glassmorphism**: 大量使用 `backdrop-filter: blur()` 营造层级感。
    *   **字体**: 标题使用衬线体 (Playfair Display) 传递叙事感，正文使用无衬线体 (Geist) 确保易读性。
    *   **动效**: 页面切换使用 Framer Motion 实现平滑过渡，避免突兀的跳转。

### 6.2 交互原则
*   **直接操纵**: 能拖拽的绝对不通过表单输入位置。
*   **即时反馈**: 所有保存操作需有 Toast 提示（Success/Error）。

---

## 7. 埋点需求 (Analytics Requirements)
*(由于是本地应用，当前阶段暂无服务端埋点，以下为规划)*
*   Event: `book_created` (Parameter: `destination`)
*   Event: `poi_added` (Parameter: `category`)
*   Event: `scene_created` (Parameter: `scene_name`)
*   Event: `export_pdf_clicked`

---

## 8. 附录 (Appendix)
*   [技术架构图](./implementation_plan.md) (参见 Implementation Plan)
*   [任务清单](./task.md) (参见 Task List)